<html lang="en">
<head>
    <title>DataTablesJS.</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- css -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css"/>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"/>

    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.7/css/select.bootstrap4.min.css"/>

    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap4.min.css"/>

    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css"/>

    <!-- js -->

    <script src="Stuk-jszip-3109282/dist/jszip.min.js"></script>
    <script src="Stuk-jszip-3109282/vendor/FileSaver.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

    <script src="https://cdn.datatables.net/select/1.2.7/js/dataTables.select.min.js"></script>

    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>

    <script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script>

    <script src="//cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>


</head>
<body>
<div class="container">
    <h1>dataTable</h1>
    <br>
    <div class="row">
        <div class="col" >
            <table id="example" class="table table-striped table-bordered" style="width: 100%"/>
        </div>
    </div>

    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
        Add
    </button>
    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#modify" id="openModify">
        Modify
    </button>

    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add</h2>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="id">ID</label>
                                <input type="text" class="form-control" id="id" placeholder="ID">
                                <label for="inici">Inici</label>
                                <input type="text" class="form-control" id="inici" placeholder="Inici">
                                <label for="final">Final</label>
                                <input type="text" class="form-control" id="final" placeholder="Final">
                                <label for="dificultat">Dificultat</label>
                                <select id="dificultat" class="form-control">
                                    <option value="1">Facil</option>
                                    <option value="2">Mitja</option>
                                    <option value="3">Dificil</option>
                                </select><br>
                                <label for="km">KM</label>
                                <input type="text" class="form-control" id="km" placeholder="KM">
                            </div>
                        </div>
                        <button type="button" class="btn" id="addRow" data-dismiss="modal">add</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modify" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add</h2>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="id">ID</label>
                                <input type="text" class="form-control" id="idMod" placeholder="ID" disabled>
                                <label for="inici">Inici</label>
                                <input type="text" class="form-control" id="iniciMod" placeholder="Inici">
                                <label for="final">Final</label>
                                <input type="text" class="form-control" id="finalMod" placeholder="Final">
                                <label for="dificultatMod">Dificultat</label>
                                <select id="dificultatMod" class="form-control">
                                    <option value="1">Facil</option>
                                    <option value="2">Mitja</option>
                                    <option value="3">Dificil</option>
                                </select><br>
                                <label for="km">KM</label>
                                <input type="text" class="form-control" id="kmMod" placeholder="KM">
                            </div>
                        </div>
                        <button type="button" class="btn" id="modifyRow" data-dismiss="modal">add</button>
                    </form>
                </div>
            </div>
        </div>
    </div>



    <button type="button" class="btn" id="remove">remove</button>
    <button type="button" class="btn" id="zip">zip</button>
</div>


<script type="text/javascript">
    let diff = ['', 'facil', 'mitja', 'dificil']

    $(document).ready( function () {
        $('#example').DataTable( {
            ajax: {
                url: '../jsons/ruteJson.php',
                dataSrc: '',
                type:"POST",
            },
            columns:  [
                {title: "ID", data:'id'},
                {title: "Inici", data:'inici'},
                {title: "Final", data:'final'},
                {title: "Dificultat", data:'3'},
                {title: "KM", data:'km'}
            ],
            select: 'single',
            responsive: true,
            "language": {
                "sProcessing":     "Procesando...",
                "sLengthMenu":     "Mostrar _MENU_ registros",
                "sZeroRecords":    "No se encontraron resultados",
                "sEmptyTable":     "Ningún dato disponible en esta tabla =(",
                "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix":    "",
                "sSearch":         "Buscar:",
                "sUrl":            "",
                "sInfoThousands":  ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst":    "Primero",
                    "sLast":     "Último",
                    "sNext":     "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
                "buttons": {
                    "copy": "Copiar",
                    "colvis": "Visibilidad"
                }
            },
            dom: 'Bfrtip',
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ],

            createdRow: function( row, data, dataIndex ) {
                if (data['3'] == "dificil") {
                    $(row).addClass('bg-danger');
                } else if (data['3'] == "mitja") {
                    $(row).addClass('bg-warning');
                } else if (data['3'] == "facil") {
                    $(row).addClass('bg-success');
                }
            }
        });

        let t = $('#example').DataTable();


        $('#addRow').on( 'click', function () {

            $.ajax({
                url: '../jsons/AddRute.php',
                type: 'POST',
                dataType: "json",
                data: {
                    id: $("#id").val(),
                    inici: $("#inici").val(),
                    final: $("#final").val(),
                    diff: $("#dificultat").val(),
                    km: $("#km").val(),
                }
            }).done(function(data){

            }).fail(function(jqXHR, textStatus, errorThrown) {
                alert(jqXHR.responseText);
            });

            t.row.add( {
                "id": $("#id").val(),
                "inici": $("#inici").val(),
                "final": $("#final").val(),
                "3": diff[$("#dificultat").val()],
                "km": $("#km").val(),
            } ).draw( false );
        } );


        $('#remove').click( function () {
            $.ajax({
                url: '../jsons/DeleteRute.php',
                type: 'POST',
                dataType: "json",
                data: {
                    id: t.row('.selected').data()[0],
                }
            }).done(function(data){

            }).fail(function(jqXHR, textStatus, errorThrown) {
                alert(jqXHR.responseText);
            });

            t.row('.selected').remove().draw( false );
        } );


        $('#openModify').click( function () {
            let data = t.row('.selected').data();

            let dif = { "facil": 1, "mitja": 2, "dificil": 3 };

            $("#idMod").val(data['id']);
            $("#iniciMod").val(data['inici']);
            $("#finalMod").val(data['final']);
            $("#dificultatMod").val(dif[data['3']]);
            $("#kmMod").val(data['km']);
        } );

        $('#modifyRow').on( 'click', function () {



            $.ajax({
                url: '../jsons/modiRute.php',
                type: 'POST',
                dataType: "json",
                data: {
                    id: $("#idMod").val(),
                    inici: $("#iniciMod").val(),
                    final: $("#finalMod").val(),
                    diff: $("#dificultatMod").val(),
                    km: $("#kmMod").val(),
                }
            }).done(function(data){

            }).fail(function(jqXHR, textStatus, errorThrown) {
                alert(jqXHR.responseText);
            });

            t.row('.selected').data( {
                "id": $("#idMod").val(),
                "inici": $("#iniciMod").val(),
                "final": $("#finalMod").val(),
                "3": diff[$("#dificultatMod").val()],
                "km": $("#kmMod").val(),
            } ).draw( false );

            t.ajax.reload();

        } );

        $('#zip').click(function () {
            var zip = new JSZip();
            var img = zip.folder("images");
            img.file("ex.jpg", "R0lGODdhBQAFAIACAAAAAP/eACwAAAAABQAFAAACCIwPkWerClIBADs=", {base64: true});
            zip.generateAsync({type:"blob"})
                .then(function(content) {
                    // see FileSaver.js
                    saveAs(content, "example.zip");
                });
        })

    });
</script>
</body>
</html>